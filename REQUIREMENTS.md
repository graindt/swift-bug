# Swift Bug 插件 - 详细需求规格说明书

## 1. 项目背景与目标

### 1.1 项目背景
在Web应用开发和测试过程中，Bug的复现往往是一个耗时且困难的任务。开发者和测试人员经常遇到以下问题：
- Bug发生时的具体环境难以记录
- 用户会话状态（登录信息、本地数据）难以保存
- 控制台错误信息容易丢失
- Bug复现需要重复繁琐的步骤

### 1.2 项目目标
开发一个Chrome插件，能够：
- 一键保存当前页面的完整状态信息
- 将Bug相关数据导出为可分享的文件
- 通过导入文件快速还原Bug现场
- 提供简洁易用的用户界面

## 2. 功能需求详细说明

### 2.1 Bug快照保存功能

#### 2.1.1 数据收集范围
**必须收集的数据：**
- 当前页面URL（包括查询参数和hash）
- 页面标题
- 时间戳（精确到秒）
- 用户代理字符串
- 页面Cookies（所有相关域名）
- LocalStorage全部内容
- SessionStorage全部内容
- 控制台输出历史（最近100条记录）
- 页面截图（Base64格式）

**可选收集的数据：**
- 网络请求记录（最近20个请求）
- 页面DOM结构快照
- 浏览器窗口尺寸

#### 2.1.2 数据收集实现方式
- **Cookies**: 使用Chrome Extension API的`chrome.cookies`
- **Storage**: 通过Content Script注入页面获取
- **控制台**: 重写console方法进行监听
- **网络请求**: 使用`chrome.webRequest` API


### 2.2 数据存储功能

#### 2.2.1 本地存储结构
```javascript
{
  "bugReports": {
    "bug_id_1": {
      "id": "bug_20250624_001",
      "title": "用户自定义标题或自动生成",
      "timestamp": "2025-06-24T10:30:00.000Z",
      "url": "https://example.com/page",
      "pageTitle": "页面标题",
      "userAgent": "Mozilla/5.0...",
      "data": {
        "cookies": [],
        "localStorage": {},
        "sessionStorage": {},
        "consoleLog": [],
        "screenshot": "data:image/png;base64,..."
      },
      "description": "Bug描述信息",
      "tags": ["login", "critical"]
    }
  },
  "settings": {
    "maxStoredReports": 50,
    "includeScreenshot": true,
    "includeNetworkRequests": false
  }
}
```

#### 2.2.2 存储限制
- 单个Bug报告最大10MB
- 最多存储50个Bug报告
- 超出限制时自动删除最旧的记录
- 提供存储空间使用情况显示

### 2.3 导出功能

#### 2.3.1 导出格式
**主要格式：JSON**
- 标准JSON格式，便于程序处理
- 包含版本信息，确保向后兼容
- 支持数据压缩减少文件大小

**文件命名规则：**
- 单个Bug: `bug-report-{url-domain}-{timestamp}.json`

#### 2.3.2 导出选项
- 单个Bug报告导出

### 2.4 导入还原功能

#### 2.4.1 导入流程
1. 用户选择JSON文件
2. 解析并验证文件格式
3. 显示导入预览信息
4. 用户确认后执行还原

#### 2.4.2 还原过程
1. **页面跳转**: 自动导航到Bug发生的URL
2. **数据注入**:
   - 设置Cookies到对应域名
   - 注入LocalStorage数据
   - 注入SessionStorage数据
3. **状态确认**: 检查数据是否成功注入
4. **用户提示**: 显示还原完成状态

#### 2.4.3 还原限制与注意事项
- 某些HTTPS网站可能限制Cookie设置
- 跨域限制可能影响数据注入
- 页面结构变化可能导致还原失效
- 提供还原失败的详细错误信息

## 3. 用户界面需求

### 3.1 Popup窗口设计

#### 3.1.1 主界面布局
```
┌─────────────────────────────────┐
│ 🐛 Swift Bug         │
├─────────────────────────────────┤
│ 当前页面: example.com          │
│ [📸 保存Bug快照]               │
├─────────────────────────────────┤
│ Bug记录 (3/50)                 │
│ ┌─── Bug #001 ───────────────┐ │
│ │ 登录页面错误                │ │
│ │ example.com/login          │ │
│ │ 2025-06-24 10:30          │ │
│ │ [查看] [导出] [删除]       │ │
│ └───────────────────────────┘ │
│ [📁 导入Bug] [⚙️ 设置]        │
└─────────────────────────────────┘
```

#### 3.1.2 交互设计
- **保存按钮**: 点击后显示保存进度，完成后显示成功提示
- **记录列表**: 显示最近5条记录，支持滚动查看更多
- **操作按钮**: 悬停显示详细信息
- **状态提示**: 实时显示操作状态和结果

### 3.2 设置页面设计

#### 3.2.1 设置选项
- **数据收集设置**
  - 是否收集网络请求
  - 控制台日志保存数量

- **存储设置**
  - 最大存储Bug数量
  - 自动清理策略
  - 存储空间使用情况

## 4. 技术实现需求

### 4.1 Chrome Extension API需求

#### 4.1.1 必需权限
```json
{
  "permissions": [
    "activeTab",
    "storage",
    "cookies",
    "downloads",
    "tabs",
    "scripting"
  ],
  "host_permissions": [
    "<all_urls>"
  ]
}
```

#### 4.1.2 可选权限
```json
{
  "optional_permissions": [
    "webRequest",
    "debugger",
    "desktopCapture"
  ]
}
```

### 4.2 架构设计

#### 4.2.1 组件通信架构
```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Popup     │◄──►│ Background  │◄──►│   Content   │
│    UI       │    │   Script    │    │   Script    │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │
       ▼                   ▼
┌─────────────┐    ┌─────────────┐
│   Options   │    │   Storage   │
│    Page     │    │    API      │
└─────────────┘    └─────────────┘
```

#### 4.2.2 数据流设计
1. **收集阶段**: Content Script → Background Script → Storage
2. **存储阶段**: Background Script → Chrome Storage API
3. **导出阶段**: Storage → Background Script → Downloads API
4. **导入阶段**: File Input → Background Script → Content Script

## 5. 性能与质量需求

### 5.1 性能指标
- Bug快照保存时间 < 3秒
- 文件导出时间 < 5秒（10MB文件）
- 数据还原时间 < 10秒
- 内存占用 < 50MB
- 存储空间 < 100MB

### 5.2 兼容性需求
- Chrome 88+版本支持
- 支持所有主流网站
- 处理特殊字符和编码
- 适配移动端Chrome

### 5.3 错误处理
- 网络错误的graceful处理
- 权限被拒绝的提示
- 数据损坏的恢复机制
- 详细的错误日志记录

## 6. 测试需求

### 6.1 功能测试用例
1. **基础功能测试**
   - Bug快照保存测试
   - 数据导出测试
   - 文件导入测试
   - 数据还原测试

2. **边界条件测试**
   - 大文件处理测试
   - 网络异常测试
   - 权限限制测试
   - 存储空间不足测试

3. **兼容性测试**
   - 不同网站测试
   - 不同Chrome版本测试
   - 特殊字符处理测试

### 6.2 用户体验测试
- 界面响应速度测试
- 操作流程便利性测试
- 错误提示友好性测试
- 新用户上手难度测试

## 7. 发布与维护

### 7.1 发布计划
- **Alpha版本**: 基础功能实现
- **Beta版本**: 完整功能测试
- **正式版本**: Chrome Web Store上架

### 7.2 维护计划
- 定期更新Chrome API兼容性
- 用户反馈处理
- 安全漏洞修复
- 功能改进和优化

---

本需求文档为Swift Bug插件的开发提供了完整的功能规格说明。开发团队可以基于此文档进行详细的技术设计和实现。
